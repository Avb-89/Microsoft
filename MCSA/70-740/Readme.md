## Установка и настройка Windows Server 2016 (70-740):

### _Сначала рассмотрим версии WindowsServer2016_

**Есть 2 основных издания:**

| Datacenter Edition | Standart Edition |
|----------------|:---------:|
| Стандартный функционал | Стандартный функционал |
| Неограниченное число виртуальных машин (в Hyper-v) | Две виртуальные машины (в Hyper-v) |
| Неограниченное число контейнеров (в Hyper-v) | Два контейнера (в Hyper-v) |
| Неограниченное число Контейнеров | Неограниченное число Контейнеров |
| Host Guardian Service | Host Guardian Service |
| Nano Server | Nano Server |
| Storage Soaces Direct | -- |
| Storage Replica | -- |
| Shielded VMs | -- |
| Advanced Networking | -- |

Суть таблицы в том, что Datacenter Edition создавался с расчетом, использования его в качестве хоста для виртуальных машин или контейнеров.
Для остального целесообразнее будет использовать Standart Edition

### _Минимальные требования_

* `1.4 Ghz x64 с поддержкой NX, DEP, CMPXCHG16b, LAHF/SAHF, и PrefetchW` -- (Подходит большинство современных процессоров)    
* `SLAT support (EPT or NPT)`    
* `512 MB* or 2GB ECC-type (or similar) RAM` -- (512 не хватит на установку (надо 1024), но это минимальное кол-во озу, для уже работающей машины, поэтому microsoft указало его в минималках)    
* `32 GB* Hard disk space` -- (32гб это минимум для работы, все остальное, обновления и оснастки потребуют больше места)     
* `Gigabit Ethernet NIC that is PCI Express compliant and support PXE`

### _Способы Установки_

Существует три способа установки Windows Server 2016    
1) `Server Core` -- Он меньше занимает места, меньше потребляет ресурсов, не имеет пользовательского интерфейса (что дает ему большую защиту, так как количество уязвимостей резко падает, а это дает возможность реже обновляться)

2) `NanoServer` -- Он cоздан исключительно для работы с контейнерами. Управляется только удаленно через PowerShell, или консолью администрирования (mmc). Через консоль сервера можно сделать незначительные настройки, такие как поменять IP.

3) `Desktop Experience` - Это стандартный сервер который мы чаще всего видим.

### _Установка_

Для работы я выбрал Hyper-v так как мне просто удобно с ним работать и он встроен в windows 10 pro, а также можно легко управлять виртуальными машинами через PowerShell. Вы можете использовать любую среду виртуализации которая нравится вам (Virtual Box, Esxi, KVM, Vmware workstation и прочие).    
Я сделал 1 машину:
`2GB MEM`
`60GB HDD`
`1 CPU`    
И вторую:
`1GB MEM`
`60GB HDD`
`1CPU`

Не думаю, что надо учить вас как установить Windows по дефолту.    
~~Нажимаем далее, далее, далее, далее, без заморочек.~~    

**На первой машине:***    
Из списка ОС выбираем windows Server 2016 (Desktop Experience)


Устанавливаем пароль для пользователя.

После установки перед вами откроется консоль администрирования там мы и поменяем `имя` и `IP адрес`.


1) нажимаем на ссылки и нам откроются нужные места где поменять пораметры:
TODO:Добавить картинку
2) Меняем имя    
TODO:Добавить картинку

3) Меняем IP Адрес. Я выбрал 192.168.3.1 Но вы можете использовать любой.
TODO:Добавить картинку

**На второй Машине**:    
но в этот раз уже выберем из списка Windows server 2016

После установки вас встретит черное окошко cmd.exe

Настройка имени и IP адреса делается проще чем с интерфейсом:

````
C:\Users\Administrator>sconfig
````
В нашем случае ip адрес выставим "DHCP"

***Настройка через PowerShell:***
Чтобы воспользоваться PowerShell мы должны ввести команду
```
C:\Windows\System32>PowerShell
```
теперь очистим экран
```
[S1]: PS C:\Users\Administrator\Documents> cls
```

Для того чтобы просмотреть информацию о подключении (может пригодиться для сложных PowerShell скриптов)
```
[S1]: PS C:\Users\Administrator\Documents> Get-NetIPAddress
```
Для изменения IP адреса
```
[S1]: PS C:\Users\Administrator\Documents> New-NetIPAddress -InterfaceAlias Ethernet -IPAddress 192.168.3.3 -PrefixLength 24 -DefaultGateway 192.168.3.1
```
Для того чтобы прописать DNS, если у вас несколько dns пишем их через запятую.
```
[S1]: PS C:\> Set-DnsClientServerAddress -InterfaceAlias Ethernet -ServerAddresses ("192.168.3.1")
```
В нашей лабаратории нужно получить адрес от DHCP:
```
[S1]: PS C:\Users\Administrator\Documents> Set-NetIPInterface -InterfaceAlias Ethernet -Dhcp Enabled
```
название `InterfaceAlias` я взял с вывода команды `Get-NetIPAddress`

Теперь разберемя с именем машины:    
для начала выясним имя машины на данный момент
```
[S1]: PS C:\> hostname
```
Потом изменим имя на то которое хотим:
```
[S1]: PS C:\> Rename-Computer -NewName S1
```
машина потребует перезагрузиться.

Поменяем разрешение экрана:
```
[S1]: PS C:\Users\Administrator\Documents> Get-DisplayResolution
```
Покажет какое в данный момент у меня разрешение, и при необходимости я могу поменять его командой `Set-DisplayResolution 1280  720` (разрешение которое вам нужно, например попробуйте `1280  720`)

Вторым шагом установим время и дату:
Установим зону
```
[S1]: PS C:\Users\Administrator\Documents> Set-TimeZone "Mauritius Standard Time"
```
чтобы выяснить какие зоны есть в системе достаточно ввести и на экране появится список все зон
```
[S1]: PS C:\Users\Administrator\Documents> tzutil.exe /l
```
Собственно настройка времени и даты
```
[S1]: PS C:\Users\Administrator\Documents> Set-Date -date "2/4/2019 17:40 PM"

Monday, February 4, 2019 5:40:00 PM
```
Теперь активируем наш windows
```
[S1]: PS C:\> slmgr.vbs -ipk XXXX-XXXX-XXXX-XXXX-XXXX
```
XXX- 'это ключ продукта который вы преобрели'.


### _Установка Ролей и компонентов (Desktop Вариант)_

Microsoft предлогает несколько способов для определения ролей сервера. Первый это всем знакомый мастер "Добавить роли и компоненты" и второй (самая удобная на мой взгляд) это установка через PowerShell

Нажимаем на добавить роли
TODO:Добавить картинку
В windows Server 2016 мы можем устанавливать роли не только на этой машине но и на других серверах под управлением Windows 2012 и выше. (В данном слайде не видно, так как машина у нас одна)
TODO:Добавить картинку
Для Примера давайте установим роль IIS сервер. Если нажать на "Inclide management tools" нам автоматически доставится и консоль управления IIS сервером.
TODO:Добавить картинку

Ставить будем по дефолту, дальше далее далее

На экране Confirm Installation selections есть ссылочка на нашу конфигурацию. Это действительно круто, т.к. вы можете развернуть точно такую же конфигурацию на других серверах. Он сохранит по сути уже настроеный скрипт с вашими требованиями.
TODO:Добавить картинку


Для работы нашей маленькой лабаратории нам потребуется чтобы кто-то раздавал IP адреса. Эту роль на себя берет DHCP

Чтобы увидеть какие есть роли и компоненты, а также проверить установлены ли они:

```
PS C:\> Get-WindowsFeature

```

Чтобы проверить установлен ли у нас непосредственно DHCP введем:

```
[DC1]: PS C:\> Get-WindowsFeature -Name *dhcp*

Display Name                                            Name                       Install State
------------                                            ----                       -------------
[ ] DHCP Server                                         DHCP                           Available
        [ ] DHCP Server Tools                           RSAT-DHCP                      Available
```
Видно что эта роль у нас не установлена.
Чтобы установить ее воспользуемся командой
```
[DC1]: PS C:\> Install-WindowsFeature -Name DHCP, RSAT-DHCP  -IncludeAllSubFeature

Success Restart Needed Exit Code      Feature Result
------- -------------- ---------      --------------
True    No             Success        {Remote Server Administration Tools, DHCP ...
```
Теперь снова глянем установлена ли роль

```
[DC1]: PS C:\> Get-WindowsFeature -Name *dhcp*

Display Name                                            Name                       Install State
------------                                            ----                       -------------
[X] DHCP Server                                         DHCP                           Installed
        [X] DHCP Server Tools                           RSAT-DHCP                      Installed
```
Роль установлена. Настроим ее
TODO: процесс настройки dhcp

Теперь у нас есть dhcp сервер который раздает адреса.
