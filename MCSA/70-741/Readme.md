```
Заранее извеняюсь, пишу на разных машинах, поэтому название серверов могут немного отличаться время от времени.
DC = DOMAIN
S1 = Server
Поднято 2 лабаратории в разное время. потом приведу в нормальный вид все.
```

# DNS
Роль DNS заключается в том, чтобы переводить доменные имена(FQDN) в IP адреса.    
Например адрес  google-public-dns-a.google.com в 8.8.8.8 и наоборот.

DNS можно использовать для поиска таких служб как почтовые серверы, серверы имен или контроллера домена.
Например для того чтобы найти почтовый сервер определенной зоны DNS надо сделать запрос типа MX.
`MX - mail exchange`

### Public DNS
Когда вы думаете о своей собственной инфрастуктуре, вы должны думать как публично так и внутренне.
Это связано с тем что в процессе созадния, у вас будут определенные записи которые вы захотите сделать доступными для клиентов в интернете.

Для внешнего днс используются записи таких типов:     
* NS записи - это записи имен, требуется для того чтобы в интернете могли понять кто вы.     
* MX записи - требуется для движения почты в интернете     
* Web server reсords - запись для www.    
* CA запись - записи для своего центра сертификации    
И каждая запись будет использовать ваш внешний адрес.

Но также есть и внутренний днс, который зписывает почти все что есть в вашей сети. И что вы точно не хотите, так это то чтобы вся эта информация была открыта для внешнего мира. Где находятся ваши файловые сервера, где ваш SQL сервер и прочие важные обьекты структуры такие как контроллеры домена.



### FQDN

Возьмем для примера сайт www.google.com
.com - это домен верхнего уровня, можно это представить как корневая папка.
.google. - Это доменное имя, то куда обращается запрос
www. - это имя хоста.

### Зоны

Простым языком это список записей ресурсов,  например яндекс имеет айпи адрес 5.255.255.55 а гугл 173.194.44.31 итд, все это пречислено в этом списке. Поэтому когда мы набираем www.yandex.ru нас отправляет на нужную страницу, а без DNS вы не сможете попасть по нужному адресу, т.к. система просто не знает куда вас отправить.
В зонах могут быть записи поддоменов.

В локальных сетях это работает приблизительно также, например если вы наберет
```
[Server]: PS C:\Users\administrator.HOME\Documents> Resolve-DnsName domain

```
где domain имя вашего сервера (я использовал контроллер домена с только что настроенной dns ролью)    
вы получите приблизительно такой результат:

```
Name                                           Type   TTL   Section    IPAddress
----                                           ----   ---   -------    ---------
domain.Home.lab                                A      3600  Answer     192.168.243.242
```

Команда нам вернула запись с полным описанием какой тип записи используется какой Ip скрывается за именем и полное имя машины. Соответсвенно система полностью понимает куда вас направить.

Точно также произойдет и в обратную сторону:
```
[Server]: PS C:\Users\administrator.HOME\Documents> Resolve-DnsName 192.168.243.242

Name                           Type   TTL   Section    NameHost
----                           ----   ---   -------    --------
242.243.168.192.in-addr.arpa.  PTR    1200  Question   DOMAIN
```
Принцип работы получатся такой:
у вас на domain.home.lab лежат видосики с котятами. и чтобы их посмотреть вы обращаетесь к сети с просьбой глянуть на них.   
идет запрос к dns (который вы или DHCP прописали в параметрах IPv4 в вашей системе) "эй, а что такое domain.home.lab" и dns ему в ответ "это 192.168.243.242 иди туда бро, там найдешь то что ищешь".     
Но если в Dns нет такой записи то вы получите приблизительно такой ответ:
```
[Server]: PS C:\Users\administrator.HOME\Documents> Resolve-DnsName servernevdns.home.lab
Resolve-DnsName : servernevdns.home.lab : DNS name does not exist
    + CategoryInfo          : ResourceUnavailable: (servernevdns.home.lab:String) [Resolve-DnsName], Win32Exception
    + FullyQualifiedErrorId : DNS_ERROR_RCODE_NAME_ERROR,Microsoft.DnsClient.Commands.ResolveDnsName
```
т.к такой машины у нас нет в сети, и соответсвенно к DNS она не обращалась.

### Кэширование

Принцип достаточно простой, поскольку dns это записи, то он записывает всех, кто к нему когда либо стучался и хранит определенное время, это время назывется ```Time to live (TTL)``` (срок хранения определяется администратором). И даже если мы отключим сервер который был когда то в сети, то DNS вернет нам запись, какой IP на тот момент он имел.

### Основные инструмены DNS
В DNS есть 2 основых инструмента это Nslookup и Resolve-DnsName

Nslookup используется в cmd и линуксе, их синтаксис почти эдентичен

Resolve-DnsName используется в powershell

Как это работает:

В командную строку вводим Nslookup и вы попадете в консоль программы.
с помощью ```help``` вы можете увидеть все команды доступные для этой утилиты.

Попробуем поработать с ресурсом www.google.com

```
> server www.googe.ru
Default Server:  www.googe.ru
Address:  109.206.181.75
```
